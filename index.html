<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

    <!-- Icon -->
    <link rel="icon" href="/resume/img/icon.png" type="image/png">

    <!-- Styles -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

    <link href="styles.css" rel="stylesheet">

    <!-- JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
</head>
<body>

<div class="search-container">
    <input type="text" id="search-bar" class="search-bar" placeholder="Search Keyword in Projects..."
           oninput="searchResume()"/>
</div>

<div class="container">

    <div id="topRightCorner" class="topRightCorner"></div>

    <div class="header">
        <div class="profile-picture-container">
            <img src="/resume/img/profile_picture.jpeg" alt="Profile Picture" class="profile-picture">
        </div>

        <div class="profile-info">
            <h1 class="profile-info-name" id="myNameTitle"></h1>
            <p class="profile-info-email" id="pdfEmailHeader"></p>

            <div class="live-resume">
                <div class="live-resume-url">psavidis.github.io/resume</div>
                <img src="/resume/img/qr-code.png" alt="QR Code" class="live-resume-qr">
            </div>
        </div>
    </div>

    <div>
        <p id="summary" class="profile-title"></p>
        <h2>Summary</h2>
        <p id="summary-intro">
            Welcome to the
            <span class="liveSummary">Dynamic | Git-powered | Code-driven</span>
            <span class="pdfSummary hidden">PDF</span> version of my resume.
            <span class="pdfSummary hidden">For the live, coded experience, visit the link or scan the QR code</span>
            <span class="emoji">ü§ò</span>
        </p>
        <div id="summary-instructions">
            <ul>
                <li>Feel free to <b>Connect</b> with me via email or LinkedIn to explore potential business
                    opportunities
                </li>
                <li><b>Download</b> my resume in PDF format
                </li>
                <li><b>Search</b> through my projects using simple keywords
                </li>
            </ul>
        </div>
        <p id="summary-free">Outside of work, I‚Äôm passionate about traveling, making music, reading philosophy, and
            swimming.
            <br>

            <span class="fun-fact">Fun Fact:</span>
            <span class="fun-fact-text">I've got dual citizenship</span>
            <span class="emoji-flags">
                <img src="img/flag_gr.png" alt="GR">
                <img src="img/flag_au.png" alt="AU">
            </span> Ô∏è
        </p>
    </div>

    <div class="section" id="experience">
        <h2 id="experienceTitle">Experience</h2>
        <ul id="experience-list"></ul>
    </div>

    <div class="section" id="Projects">
        <h2>Projects</h2>
        <ul id="projects-list"></ul>
    </div>

    <div class="section" id="education">
        <h2>Education</h2>
        <ul id="education-list"></ul>
    </div>

    <!-- Hidden contact form with animation -->
    <div id="contact-form-container" style="display: none;">
        <form id="contact-form" action="https://api.web3forms.com/submit" method="POST" autocomplete="on">

            <!-- REQUIRED: Web3Forms access key -->
            <input type="hidden" name="access_key" value="fb378ea5-c240-451b-bc68-52b3ce5696f0">

            <!-- Optional: Redirect URL after success -->
            <input type="hidden" name="redirect" value="https://web3forms.com/success">

            <div class="email-display">
                <label for="yourEmail"><b>To:</b></label>
                <input id="yourEmail" type="text" value="peter.savidis1@gmail.com" readonly/> <!-- Greyed-out input -->
                <button id="copyButton" type="button" onclick="copyEmail()">Copy</button>
            </div>

            <div class="form-group">
                <label id="form-name">Your Name:
                    <input type="text" id="name" name="name" required autocomplete="name">
                </label>
            </div>

            <div class="form-group">
                <label id="form-email">Your Email:
                    <input type="email" id="email" name="email" required autocomplete="email">
                </label>
            </div>

            <div class="form-group">
                <label id="form-message">Your Message:
                    <textarea id="message" name="message" required></textarea>
                </label>
            </div>

            <button type="submit" class="submit-button">Send Message</button>

        </form>

        <div id="loading-message" style="display: none;">
            <p>Sending your message...</p>
        </div>

        <div id="error-message" style="display: none;">
            <p>Oops! Something went wrong. Please try again.</p>
        </div>

        <div id="thank-you-message">
            <h2>üéâ Thank you!</h2>
            <p>Your message has been sent. I'll get back to you soon!</p>
        </div>
    </div>
    <div id="shortcuts">
        <h2>Keyboard Shortcuts</h2>
        <ul>
            <li><strong>‚åò + F</strong>: Search Projects</li>
            <li><strong>‚åò + S</strong>: Download Resume</li>
            <li><strong>‚åò + E</strong>: Send Email</li>
            <li><strong>‚åò + Shift + L</strong>: Open LinkedIn</li>
            <li><strong>‚åò + Shift + M</strong>: Open Location</li>
        </ul>
    </div>
</div>

<div class="button-container">
    <button id="email-btn" class="btn"><i class="fas fa-envelope"></i></button>
    <button id="phoneButton" class="btn"><i class="fas fa-phone-alt"></i></button>
    <button id="location-btn" class="btn"><i class="fas fa-map-marker-alt"></i></button>
    <button id="linkedin-btn" class="btn"><i class="fab fa-linkedin-in"></i></button>
    <button id="github-btn" class="btn"><i class="fab fa-github"></i></button>
    <button id="pdf-btn" class="btn"><i class="fas fa-file-pdf"></i></button>
    <button id="toggle-search" class="btn toggle-button"><i class="fas fa-search"></i></button>

    <div id="overlay">
        <div id="circle"></div>
        <div id="phone-message">Would you like to have a chat? Feel free to send me an email, and we can schedule a
            convenient
            time for a phone call. Looking forward to connecting!
        </div>
    </div>
</div>

<script>

    // For production, always serve the static PDF file to avoid devices issues.
    const productionMode = true;

    // Functions: Main Features

    function downloadPage() {

        if (productionMode) {
            downloadStaticPDF();
            return;
        }

        showProfileInfo();
        hideFormContainer();

        showPdfSummary();

        const resume = document.querySelector('.container');

        if (!resume) {
            console.error("Resume container not found!");
            return;
        }

        // Add class to disable transforms, animations, etc.
        resume.classList.add('pdf-mode');

        const projectItems = document.querySelectorAll('.project-li');

        customizePageBreaks(projectItems);

        const techUsed = document.querySelectorAll('.project-tech');
        const projectDescriptions = document.querySelectorAll('.project-description');
        const projectPoints = document.querySelectorAll('.project-points');
        const projectButtons = document.querySelectorAll('.project-button');

        makeVisible(projectItems);
        makeVisible(techUsed);
        makeVisible(projectDescriptions);
        makeVisible(projectPoints);
        makeButtonsVisible(projectButtons);

        hideShortcuts();

        // Save the original styles
        const container = document.querySelector('.container');
        const originalHeight = container.style.height;
        const originalMaxHeight = container.style.maxHeight;
        const originalOverflow = container.style.overflow;

        container.style.height = 'auto';
        container.style.maxHeight = 'none';
        container.style.overflow = 'visible';

        // Give the browser time to apply styles
        setTimeout(() => {
            html2pdf()
                .from(resume)
                .set({
                    margin: 0,
                    filename: 'resume-petros_savidis.pdf',
                    pagebreak: {
                        mode: ['css', 'legacy']  // must include 'css' so page-break styles are respected
                        // after: '.page-break'
                    },
                    image: {type: 'jpeg', quality: 0.98},
                    html2canvas: {
                        scale: 2,
                        useCORS: true,
                        logging: true,
                        backgroundColor: '#ffffff',
                        scrollY: 0
                    },
                    jsPDF: {unit: 'in', format: 'a4', orientation: 'portrait'}
                })
                .save()
                .then(() => {
                    // Disable scroll and height properties temporarily when the PDF button is clicked
                    container.style.height = originalHeight;
                    container.style.maxHeight = originalMaxHeight;
                    container.style.overflow = originalOverflow;
                })
                .then(() => {
                    // resume.classList.remove('pdf-mode');
                    location.reload();
                })
                .catch(err => {
                    console.error("PDF generation failed:", err);
                    resume.classList.remove('pdf-mode');
                });
        }, 300); // give time for the style to apply
    }

    function downloadStaticPDF() {
        const link = document.createElement('a');
        link.href = 'resume-petros_savidis.pdf';  // Your PDF file
        link.download = 'resume-petros_savidis.pdf'; // Suggested filename
        document.body.appendChild(link);

        // Simulate a user click to start the download
        link.click();

        // Give the browser a moment to trigger the download
        setTimeout(() => {
            location.reload();
        }, 500); // 0.5 second is enough here, because download already triggered

        // Clean up
        document.body.removeChild(link);
    }

    function searchResume() {
        let input = document.getElementById('search-bar').value.toLowerCase();
        let sections = document.querySelectorAll('#Projects'); // Assuming sections are in the 'container' class

        // Add a class to disable animations during search
        document.body.classList.add('searching');

        sections.forEach(section => {
            // Reset previous highlights and ensure animation is not triggered
            removeHighlights(section);

            // Only proceed if there is search input
            if (input === '') {
                section.style.display = 'block'; // Show the section if search input is empty
                return;
            }

            let textContent = section.textContent || section.innerText;
            if (textContent.toLowerCase().includes(input)) {
                // section.style.display = 'block'; // Show the section if it contains the search term
                highlightText(section, input); // Highlight the matching text
            } else {
                // section.style.display = 'none'; // Hide the section if it does not contain the search term
            }
        });

        // Remove the class to re-enable animations after a short delay
        setTimeout(() => {
            document.body.classList.remove('searching');
        }, 1000); // Timeout to allow changes to take place before animations are re-enabled
    }

    // Functions: Create elements

    function createCompanyImg(item) {
        const img = document.createElement('img');

        img.src = item.companyLogo;
        img.classList.add('project-image');
        img.style.width = '40px';
        img.style.height = '40px';
        img.style.borderRadius = '50%';
        img.style.marginRight = '10px';
        img.style.verticalAlign = 'middle';

        const link = document.createElement('a');
        link.href = item.companyLink || '#'; // Default to "#" if no URL provided

        link.appendChild(img);

        return link;
    }

    function createSchoolImg(item) {
        const img = document.createElement('img');

        img.src = item.schoolLogo;
        img.classList.add('university-image');
        img.style.width = '40px';
        img.style.height = '40px';
        img.style.borderRadius = '50%';
        img.style.marginRight = '10px';
        img.style.verticalAlign = 'middle';

        const link = document.createElement('a');
        link.href = item.schoolLink || '#'; // Default to "#" if no URL provided

        link.appendChild(img);

        return link;
    }

    function createProjectButtons(project) {
        const projectLinks = project.links;

        if (!projectLinks) {
            return []; // No references to show
        }

        let result = [];

        Object.entries(projectLinks).forEach(([key, link]) => {
            const projectButton = document.createElement('a');

            projectButton.classList.add('project-button');
            projectButton.textContent = key;
            projectButton.href = link || '#'; // Default to "#" if no URL provided
            projectButton.target = '_blank'; // Open in new tab
            projectButton.style.display = 'none';
            projectButton.style.marginTop = '10px';
            projectButton.style.marginRight = '10px'; // Add margin between buttons
            projectButton.style.padding = '8px 12px';
            projectButton.style.background = '#007BFF';
            projectButton.style.color = 'white';
            projectButton.style.textDecoration = 'none';
            projectButton.style.borderRadius = '5px';
            projectButton.style.fontSize = '11px';
            projectButton.style.fontWeight = 'bold';
            projectButton.style.textAlign = 'center';
            projectButton.style.width = 'fit-content';
            projectButton.style.transition = 'background 0.3s';

            // Button hover effect
            projectButton.addEventListener('mouseover', () => {
                projectButton.style.background = '#0056b3';
            });
            projectButton.addEventListener('mouseout', () => {
                projectButton.style.background = '#007BFF';
            });

            result.push(projectButton);
        });

        return result;
    }

    // Functions: Load Data / Populate

    async function loadResumeData() {
        try {
            const response = await fetch('data.json');
            if (!response.ok) throw new Error('Failed to fetch data');

            const data = await response.json();

            populateNameTitle(data);
            populateTitle(data);

            populateHeader(data);
            populateWorkExperience(data);
            populateProjects(data);
            populateEducation(data);

            // buttons
            configureLocationButton(data);
            configureLinkedinButton(data);
            configureEmail(data);
            configureGithubButton();
        } catch (error) {
            console.error('Error loading resume data:', error);
        }
    }

    function populateNameTitle(data) {
        document.getElementById("myNameTitle").textContent = data.name;
    }

    function populateTitle(data) {
        document.title = data.name + " Resume";
    }

    function populateHeader(data) {
        document.getElementById('name').textContent = data.name || 'Name not provided';

        let fontSize = '13px';

        let summary = document.getElementById('summary');
        summary.textContent = data.summary || 'Summary not provided';
        summary.style.textAlign = 'left';
        summary.style.fontSize = fontSize;

        let summaryIntro = document.getElementById('summary-intro');
        summaryIntro.style.textAlign = 'left';
        summaryIntro.style.fontSize = fontSize;

        let summaryFree = document.getElementById('summary-free');
        summaryFree.style.textAlign = 'left';
        summaryFree.style.fontSize = fontSize;

        let summaryInstructions = document.getElementById('summary-instructions');
        summaryInstructions.style.textAlign = 'left';
        summaryInstructions.style.fontSize = fontSize;
    }

    function populateWorkExperience(data) {
        const experienceList = document.getElementById('experience-list');
        experienceList.innerHTML = '';

        if (!Array.isArray(data.workExperience)) {
            experienceList.innerHTML = '<li>No experience data available</li>';
            return;
        }

        data.workExperience = sortByField(data.workExperience, 'startDate', 'asc');

        data.workExperience.forEach(item => {
            const li = document.createElement('li');
            li.classList.add('work-experience');

            const workTitleAndImg = document.createElement('div');
            workTitleAndImg.classList.add('work-title');

            // Create company logo image
            const companyImg = createCompanyImg(item);

            // Create text span for job details
            const textSpan = document.createElement('span');
            textSpan.textContent = `${item.title || 'Position not provided'} at ${item.company || 'Company not provided'} (${item.startDate || ''} - ${item.endDate || 'Present'})`;

            workTitleAndImg.appendChild(companyImg);
            workTitleAndImg.appendChild(textSpan);

            const div = document.createElement('div');
            div.classList.add('location-badge');

            const span = document.createElement('span');
            div.appendChild(span);
            div.textContent = 'üìç' + item.location;

            // Append logo and text
            li.appendChild(workTitleAndImg);
            li.appendChild(div);

            experienceList.appendChild(li);
        });

        const totalXP = getTotalExperience(data.workExperience);
        const formattedXP = formatTotalExperienceIntoYears(totalXP);

        document.getElementById('experienceTitle').textContent = 'Experience (' + formattedXP + ')';
    }

    function populateProjects(data) {
        const projectsList = document.getElementById('projects-list');
        projectsList.innerHTML = '';

        if (!Array.isArray(data.project)) {
            projectsList.innerHTML = '<li>No projects data available</li>';
            return;
        }

        data.project = sortByField(data.project, 'startDate', 'desc');

        data.project.forEach(project => {
            const li = document.createElement('li');

            li.classList.add('project-li');
            li.style.cursor = 'pointer';
            li.style.padding = '12px';
            li.style.border = '1px solid #ccc';
            li.style.borderRadius = '8px';
            li.style.marginBottom = '8px';
            li.style.backgroundColor = '#f9f9f9';
            li.style.transition = 'background-color 0.2s ease-in-out';

            li.addEventListener('mouseenter', () => {
                li.style.backgroundColor = '#e3eafc';
            });
            li.addEventListener('mouseleave', () => {
                li.style.backgroundColor = '#f9f9f9';
            });

            // Project name
            const projectName = document.createElement('span');
            projectName.textContent = project.name || 'Project not provided';
            projectName.style.color = '#1e3c72';
            projectName.style.fontSize = '18px';
            projectName.style.fontWeight = 'bold';

            // Description
            const projectDescription = document.createElement('p');
            projectDescription.classList.add('project-description');
            projectDescription.textContent = project.description || 'No description provided';
            projectDescription.style.display = 'none';
            projectDescription.style.fontSize = '14px';
            projectDescription.style.color = '#444';
            projectDescription.style.marginTop = '10px';
            projectDescription.style.textAlign = 'left';

            // Tools Used
            const techUsed = document.createElement('p');
            techUsed.classList.add('project-tech');
            techUsed.textContent = project.techUsed ? `Tools: ${project.techUsed.join(', ')}` : '';
            techUsed.style.display = 'none';
            techUsed.style.fontSize = '13px';
            techUsed.style.fontStyle = 'italic';
            techUsed.style.color = '#666';
            techUsed.style.marginTop = '5px';
            techUsed.style.textAlign = 'left';

            // Points (bullet list)
            const pointsList = document.createElement('ul');

            pointsList.classList.add('project-points');
            pointsList.style.display = 'none';
            pointsList.style.paddingLeft = '20px';
            pointsList.style.listStyleType = 'disc';
            pointsList.style.marginTop = '5px';
            pointsList.style.fontSize = '13px';

            if (project.points && Array.isArray(project.points)) {
                project.points.forEach(point => {
                    const pointItem = document.createElement('li');
                    pointItem.textContent = point.toString();
                    pointItem.style.marginBottom = '3px';
                    pointItem.style.listStyleType = 'circle';
                    pointItem.style.background = 'none';
                    pointItem.style.padding = '2px 0';
                    pointItem.style.backgroundColor = 'transparent';
                    pointItem.style.border = 'none';
                    pointItem.style.boxShadow = 'none';
                    pointsList.appendChild(pointItem);
                });
            }

            const showProjectButtons = createProjectButtons(project);

            const hasProjectButtons = showProjectButtons.length > 0;

            // Toggle description/tech/points on click
            li.addEventListener('click', () => {
                const isVisible = projectDescription.style.display === 'block';
                projectDescription.style.display = isVisible ? 'none' : 'block';
                pointsList.style.display = isVisible ? 'none' : 'block';
                techUsed.style.display = isVisible ? 'none' : 'block';

                if (hasProjectButtons) {
                    showProjectButtons.forEach(button => {
                        button.style.display = isVisible ? 'none' : 'inline-block';
                    });
                }
            });

            li.appendChild(projectName);
            li.appendChild(projectDescription);
            li.appendChild(pointsList);
            li.appendChild(document.createElement('br'));

            let hasTechUsed = techUsed && techUsed.textContent.trim() !== "Tools:";

            if (hasTechUsed) {
                li.appendChild(techUsed);
            }

            if (hasProjectButtons) {
                showProjectButtons.forEach(button => {
                    li.appendChild(button);
                });
            }

            projectsList.appendChild(li);
        });
    }

    function populateEducation(data) {
        const educationList = document.getElementById('education-list');

        if (!Array.isArray(data.education)) {
            educationList.innerHTML = '<li>No education data available</li>';
            return;
        }

        data.education.forEach(item => {
            const li = document.createElement('li');

            const textSpan = document.createElement('span');
            textSpan.textContent = `${item.school || 'Institution not provided'}, ${item.degree || 'Field of study not provided'} (${item.startYear || ''} - ${item.endYear || 'Present'})`;

            const schoolImg = createSchoolImg(item);

            li.appendChild(schoolImg);
            li.appendChild(textSpan);

            educationList.appendChild(li);
        });
    }

    function sortByField(data, field, order = 'desc') {
        return data.sort((a, b) => {
            // Extract the date components (e.g., "MM-YYYY")
            const [monthA, yearA] = a[field].split('-');
            const [monthB, yearB] = b[field].split('-');

            // Create Date objects from the extracted month and year
            const dateA = new Date(yearA, monthA - 1);  // monthA - 1 because months are 0-indexed
            const dateB = new Date(yearB, monthB - 1);  // monthB - 1 for the same reason

            // Return based on the order: ascending or descending
            if (order === 'asc') {
                return dateA - dateB; // ascending order
            } else {
                return dateB - dateA; // descending order
            }
        });
    }

    // Functions: Calculate Experience

    function calculateExperience(startDate, endDate) {
        const start = parseMonthYearString(startDate);
        const end = (endDate === 'Present') ? new Date() : new parseMonthYearString(endDate);  // Handle 'Present' as current date

        return (end.getFullYear() - start.getFullYear()) * 12 + (end.getMonth() - start.getMonth());
    }

    function formatTotalExperienceIntoYears(totalExperience) {
        const years = totalExperience.years;
        const months = totalExperience.months;

        // Format the output
        if (months > 0) {
            return `${years}+ years`; // If there are months, show a +
        } else {
            return `${years} years`; // If no months, show only years with a "+"
        }
    }

    function getTotalExperience(workExperience) {
        let totalExperienceMonths = 0;

        workExperience.forEach(job => {

            if (job.company === 'Hellenic Army') {
                return;
            }

            totalExperienceMonths += calculateExperience(job.startDate, job.endDate);
        });

        // Convert the total experience to years and months
        const years = Math.floor(totalExperienceMonths / 12);
        const months = totalExperienceMonths % 12;

        return {years, months};
    }

    function parseMonthYearString(monthYearString) {
        const [monthName, yearString] = monthYearString.split(' ');
        const year = parseInt(yearString, 10);

        const monthNames = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        const monthIndex = monthNames.indexOf(monthName);

        if (monthIndex === -1 || isNaN(year)) {
            throw new Error(`Invalid date string: ${monthYearString}`);
        }

        return new Date(Date.UTC(year, monthIndex, 1)); // Always safe
    }

    // Functions: Show/Hide Elements

    function makeButtonsVisible(projectButtons) {
        projectButtons.forEach(button => {
            // Ensure they expand to full height, and maintain a row layout when printing
            button.style.height = 'auto';
            button.style.display = 'inline-block';  // Or 'flex' if you prefer a flex container
            button.style.overflow = 'visible';
            button.style.transition = 'none';
        });
    }

    function makeVisible(elements) {
        elements.forEach(item => {
            // Directly manipulate the height and visibility to ensure they expand
            item.style.height = 'auto';  // Ensure the items expand to their full height
            item.style.display = 'block';  // Make sure the item is displayed (not hidden)
            item.style.overflow = 'visible';  // Ensure the content is visible
            item.style.transition = 'none';  // Disable any transitions that could cause issues
        });
    }

    function makeHidden(elements) {
        elements.forEach(item => {
            item.style.display = 'none';  // Make sure the item is displayed (not hidden)
        });
    }

    function hideProfileInfo() {
        document.querySelector('#pdfEmailHeader').style.display = 'none';
        document.querySelector('.live-resume').style.display = 'none';
    }

    function hideShortcuts() {
        const shortcuts = document.querySelector('#shortcuts')
        shortcuts.style.display = 'none';
    }

    function hideSearchBar() {
        const searchBar = document.getElementById('search-bar');
        searchBar.style.display = 'none';
    }

    function hideProjects() {

        const techUsed = document.querySelectorAll('.project-tech');
        const projectDescriptions = document.querySelectorAll('.project-description');
        const projectPoints = document.querySelectorAll('.project-points');
        const projectButtons = document.querySelectorAll('.project-button');

        makeHidden(techUsed);
        makeHidden(projectDescriptions);
        makeHidden(projectPoints);
        makeHidden(projectButtons);
    }

    function hideEverythingAfterSeconds(seconds) {
        setTimeout(() => {
            hideErrorMessage();
            hideThankYou();
            hideFormContainer();
        }, seconds * 1000);
    }

    function hideErrorMessage() {
        const errorMessage = document.getElementById('error-message');
        errorMessage.style.display = 'none';
    }

    function hideThankYou() {
        const thankYouMessage = document.getElementById('thank-you-message');
        thankYouMessage.style.display = 'none';
        thankYouMessage.classList.remove('show');
    }

    function hideFormContainer() {
        const formContainer = document.getElementById('contact-form-container');
        formContainer.classList.remove('show');
        formContainer.style.display = 'none';
    }

    function showProfileInfo() {
        document.querySelector('#pdfEmailHeader').style.display = 'block';
        document.querySelector('.live-resume').style.display = 'block';
    }

    function showProjects() {
        const projectItems = document.querySelectorAll('.project-li');

        const techUsed = document.querySelectorAll('.project-tech');
        const projectDescriptions = document.querySelectorAll('.project-description');
        const projectPoints = document.querySelectorAll('.project-points');
        const projectButtons = document.querySelectorAll('.project-button');

        makeVisible(projectItems);
        makeVisible(techUsed);
        makeVisible(projectDescriptions);
        makeVisible(projectPoints);
        makeButtonsVisible(projectButtons);
    }

    function showPdfSummary() {
        document.querySelectorAll('.liveSummary')
            .forEach(element => element.classList.add('hidden'));

        document.querySelectorAll('.pdfSummary')
            .forEach(element => element.classList.remove('hidden'));
    }

    function showThankYou() {
        const thankYouMessage = document.getElementById('thank-you-message');
        thankYouMessage.style.display = 'block';
        thankYouMessage.classList.add('show');
    }

    function showFormContainer() {
        const formContainer = document.getElementById('contact-form-container');
        formContainer.classList.add('show');
        formContainer.style.display = 'block';
    }

    // Functions: Customize Page Breaks (PDF)

    function customizePageBreaks(projectItems) {
        projectItems[3].style.marginTop = '15mm';
        projectItems[6].style.marginTop = '55mm'; // Eleura
    }

    // Functions: Highlighting Text

    function highlightText(section, input) {
        const words = input.split(/\s+/); // Split the input into multiple words separated by spaces
        words.forEach(word => {
            const escapedWord = escapeRegExp(word); // Escape the word for safe regex use
            const regex = new RegExp(`\\b(${escapedWord})\\b`, 'gi'); // Case-insensitive matching for whole words
            const nodes = getTextNodes(section);

            nodes.forEach(node => {
                const text = node.nodeValue;
                const parts = text.replace(regex, (match) => {
                    // Wrap matched words in a span
                    return `<span class="highlight">${match}</span>`;
                });

                if (parts !== text) { // Only replace if something was highlighted
                    const fragment = document.createDocumentFragment();
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = parts; // Use innerHTML to insert the replaced content
                    while (tempDiv.firstChild) {
                        fragment.appendChild(tempDiv.firstChild); // Append all child nodes (including the span)
                    }
                    node.replaceWith(fragment); // Replace original node with the new fragment
                }
            });
        });
    }

    function removeHighlights(section) {
        const highlightedText = section.querySelectorAll('.highlight');
        highlightedText.forEach(span => {
            const parentNode = span.parentNode;
            parentNode.replaceChild(document.createTextNode(span.innerText), span); // Replace span with plain text
        });
    }

    function getTextNodes(element) {
        let textNodes = [];
        for (let node of element.childNodes) {
            if (node.nodeType === 3) { // Text node
                textNodes.push(node);
            } else if (node.nodeType === 1) { // Element node, recurse into child elements
                textNodes = textNodes.concat(getTextNodes(node));
            }
        }
        return textNodes;
    }

    function escapeRegExp(string) {
        return string.replace(/[.*+?^=!:${}()|\[\]\/\\]/g, '\\$&');
    }

    // Functions: Scrolling

    function scrollToProjects() {
        document.getElementById("Projects").scrollIntoView({
            behavior: "smooth"
        });
        window.dispatchEvent(new Event('scroll'));

        const searchBar = document.querySelector('#search-bar');
        searchBar.style.position = 'sticky'; // Keep it fixed at the bottom
    }

    function scrollToTop() {
        document.getElementById("topRightCorner").scrollIntoView({
            behavior: "smooth"
        });
    }

    // Functions: Configure Buttons / Bars

    function configurePdfButton() {
        document.getElementById('pdf-btn').addEventListener('click', downloadPage);
    }

    function configureLinkedinButton(data) {
        document.getElementById('linkedin-btn').onclick = function () {
            let profileUrl = data.linkedInURL;
            window.open(profileUrl, '_blank');
        };
    }

    function configureLocationButton(data) {
        document.getElementById("location-btn").onclick = function () {
            let location = data.addressLocation;
            let encodedLocation = encodeURIComponent(location);  // Encode the location
            window.open(`https://www.google.com/maps?q=${encodedLocation}`, '_blank');
        };
    }

    function configureGithubButton() {
        document.getElementById("github-btn").onclick = function () {
            window.open(`https://github.com/psavidis/resume`, '_blank');
        };
    }

    function configureSearchToggle() {
        const searchToggle = document.getElementById('toggle-search');
        searchToggle.addEventListener('click', function () {
            const searchBar = document.getElementById('search-bar');

            if (searchBar.style.display === 'block') {
                searchBar.style.display = 'none';

                scrollToTop();
                hideProjects();

                // init search bar and remove highlights
                if (searchBar) {
                    searchBar.value = '';
                    searchResume();
                }

            } else {
                scrollToProjects();
                showProjects();

                searchBar.style.display = 'block';
                searchBar.focus();
            }
        });
    }

    function configureSearchBar() {
        // Configures the search bar to always remain at the top during scrolling
        window.addEventListener('scroll', function () {
            let searchBar = document.getElementById('search-bar');

            // Trigger a reflow and adjust positioning if necessary
            searchBar.style.position = 'absolute';  // temporarily change position
            searchBar.offsetHeight;  // Trigger reflow (forces layout update)
            searchBar.style.position = 'fixed';  // Reset position to fixed after reflow
        });
    }

    function configurePhoneButton() {
        const phoneButton = document.getElementById('phoneButton');
        const overlay = document.getElementById('overlay');
        const circle = document.getElementById('circle');
        const message = document.getElementById('phone-message');

        phoneButton.addEventListener('click', () => {
            // Show the overlay
            overlay.style.display = 'flex';

            // Position the circle over the button and animate it
            const buttonRect = phoneButton.getBoundingClientRect();
            const circleSize = Math.max(window.innerWidth, window.innerHeight);

            // Start the circle animation
            circle.style.left = `${buttonRect.left + buttonRect.width / 2 - circleSize / 2}px`;
            circle.style.top = `${buttonRect.top + buttonRect.height / 2 - circleSize / 2}px`;
            circle.style.width = `${circleSize}px`;
            circle.style.height = `${circleSize}px`;

            // Show the message after the circle animation ends
            setTimeout(() => {
                message.style.opacity = 1;
            }, 1000); // Delay the text appearance until after the circle animation

            setTimeout(() => {
                message.style.opacity = 0;
                circle.style.width = '0';
                circle.style.height = '0';
            }, 8000);

            // Reset everything and hide the overlay after 6 seconds
            setTimeout(() => {
                overlay.style.display = 'none'; // Hide overlay
                circle.style.left = '0'; // Reset circle position
                circle.style.top = '0'; // Reset circle position
                circle.style.width = '0'; // Reset circle size
                circle.style.height = '0'; // Reset circle size
            }, 9000); // Hide overlay and reset circle after the entire animation completes
        });
    }

    // Functions: Register Keyboard Shortcut

    function registerKeyboardShortcuts() {
        registerSearchShortcut();
        registerSavePdfShortcut();
        registerEmailShortcut();
        registerLinkedShortCut();
        registerMapsShortCut();
    }

    function registerSearchShortcut() {
        document.addEventListener('keydown', function (event) {
            // Check if Control (Windows) or Command (Mac) + F is pressed
            if ((event.ctrlKey || event.metaKey) && event.key === 'f') {
                event.preventDefault(); // Prevent the browser's default find behavior
                document.getElementById('toggle-search').click(); // Replace with your button's ID
            }
        });
    }

    function registerSavePdfShortcut() {
        document.addEventListener('keydown', function (event) {
            if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === 's') {
                event.preventDefault(); // Stop the browser's "Save Page As" behavior
                document.getElementById('pdf-btn').click();
            }
        });
    }

    function registerEmailShortcut() {
        document.addEventListener('keydown', function (event) {
            if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === 'e') {
                event.preventDefault();
                document.getElementById('email-btn').click();
            }
        });
    }

    function registerLinkedShortCut() {
        document.addEventListener('keydown', function (event) {
            // LinkedIn shortcut: Ctrl/Cmd + Shift + L
            if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key.toLowerCase() === 'l') {
                event.preventDefault(); // Prevent default action
                document.getElementById('linkedin-btn').click();
            }
        });
    }

    function registerMapsShortCut() {
        document.addEventListener('keydown', function (event) {
            // Location shortcut: Ctrl/Cmd + Shift + M
            if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key.toLowerCase() === 'm') {
                event.preventDefault(); // Prevent default action
                document.getElementById('location-btn').click();
            }
        });
    }

    // Functions: Email

    function configureEmail(data) {
        const emailHeader = document.getElementById('pdfEmailHeader');
        emailHeader.textContent = data.email;

        hideProfileInfo();

        const emailBtn = document.getElementById('email-btn');

        // Check if the user is on a mobile device
        if (isMobile()) {
            // Use mailto for mobile devices
            emailBtn.setAttribute('href', `mailto:${data.email}`);
            emailBtn.style.display = 'block';  // Ensure button is visible
            emailBtn.addEventListener('click', function (e) {
                // Optional: Prevent any further action, since mailto will open the email client
                e.preventDefault();
                window.location.href = `mailto:${data.email}`;
            });

            return;
        }

        const formContainer = document.getElementById('contact-form-container');
        const formName = document.getElementById('form-name');
        const form = document.getElementById('contact-form');

        emailBtn.addEventListener('click', function () {

            if (formContainer.style.display === 'block') {
                hideFormContainer()
            } else {
                showFormContainer()
                formName.focus();
            }
        });

        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const submitButton = document.querySelector('.submit-button');
            const loadingMessage = document.getElementById('loading-message');
            const errorMessage = document.getElementById('error-message');

            submitButton.disabled = true;
            hideThankYou();
            errorMessage.style.display = 'none';

            const formData = getFormDataAsObject(form);

            // You must manually append your Web3Forms access_key if it's not already inside the form
            formData.access_key = 'fb378ea5-c240-451b-bc68-52b3ce5696f0';
            formData.access_key = 'fb378ea5-c240-451b-bc68-52b3ce5696f0';

            try {
                loadingMessage.style.display = 'block';

                const response = await fetch('https://api.web3forms.com/submit', {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    loadingMessage.style.display = 'none';
                    showThankYou();
                    form.reset();
                } else {
                    throw new Error(result.message || 'Form submission failed.');
                }
            } catch (error) {
                loadingMessage.style.display = 'none';
                errorMessage.style.display = 'block';
                console.error(error);
            } finally {
                hideEverythingAfterSeconds(4);
                submitButton.disabled = false;
            }
        });
    }

    function getFormDataAsObject(form) {
        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => {
            data[key] = value;
        });

        return data;
    }

    function copyEmail() {
        const emailField = document.getElementById("yourEmail");
        emailField.select();  // Select the content in the input field
        document.execCommand("copy");  // Copy the selected content to clipboard
    }

    // Functions: Device Detection

    function isMobile() {
        return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    // Functions: Easter Egg

    function showEasterEgg() {
        console.log('üêáüê∞ü•öIf you see this little easter egg, you are a either developer or a curious recruiter with dev skills! Keep up the good work! üéâ');
    }

    // Call functions to load data and initialize the page components

    loadResumeData();

    hideSearchBar();

    configurePdfButton();
    configureSearchToggle();
    configureSearchBar();
    configurePhoneButton();

    registerKeyboardShortcuts();

    showEasterEgg();
</script>
</body>
</html>
