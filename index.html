<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petros Savvidis Resume</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to right, #1e3c72, #2a5298);
            color: #333;
            overflow-x: hidden;
        }
        .container {
            max-width: 800px;
            margin: 50px auto;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            animation: fadeIn 1s ease-in-out;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: slideIn 1s ease-in-out;
        }
        h2 {
            text-align: left;
            color: #1e3c72;
            border-left: 4px solid #1e3c72;
            padding-left: 10px;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .section {
            margin: 30px 0;
            animation: fadeInUp 1.2s ease-in-out;
        }
        .section ul {
            list-style-type: none;
            padding: 0;
        }
        .section ul li {
            margin-bottom: 15px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, background 0.3s ease;
        }
        .section ul li:hover {
            transform: scale(1.03);
            background: #e9f4ff;
        }
        p {
            text-align: center;
            font-size: 1.2em;
            color: #555;
            margin-bottom: 20px;
        }
        .button-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .btn {
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 10px;
            margin: 5px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            transition: background-color 0.3s ease;
        }
        .btn:hover {
            background-color: #FFC107;
        }
        .btn i {
            font-size: 1.2em;
        }

        .profile-picture-container {
            position: left;
            top: 20px;
            left: 20px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .profile-picture {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .header {
            display: flex; /* Make children align horizontally */
            align-items: center; /* Vertically center-align items */
            justify-content: space-between;
            position: relative; /* To allow absolute positioning if needed */
            padding: 0 20px; /* Optional: Add padding for spacing */
        }

        .pdf-mode * {
            animation: none !important;
            transition: none !important;
            transform: none !important;
            filter: none !important;
            opacity: 1 !important;
            box-shadow: none !important;
            contain: none !important;
            will-change: auto !important;
        }

        .pdf-mode {
            background: white !important;
            color: black !important;
        }

        .flags {
            position: absolute;
            top: 2px; /* Place flags higher on the top-right corner */
            right: 20px; /* Align them to the right */
            display: flex;
            gap: 10px;
            font-size: 48px; /* Increase emoji size */
        }

        .flag {
            font-size: 40px; /* Ensure flags are large */
        }

        /* Initial styles for images */
        .project-image, .university-image {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer; /* Ensures the pointer cursor appears when hovering */
        }

        /* On hover, scale the image and add a shadow for emphasis */
        .project-image:hover, .university-image:hover {
            transform: scale(1.05); /* Slightly increase the size */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add shadow for depth */
        }

        .work-title {
            display: flex;
            align-items: center;
        }

        .work-experience {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .location-badge {
            display: inline-flex;
            align-items: center;
            font-size: 14px;
            color: #777;
        }

        .location-badge span {
            font-size: 16px; /* Icon size */
            margin-right: 5px; /* Space between icon and location text */
        }

        /* Avoid breaking inside these elements */
        .avoid-break {
            page-break-inside: avoid;
            break-inside: avoid;
        }

        /* Force a page break before this element */
        .page-break {
            page-break-before: always;
            break-before: page;
        }

        /* Optional: Force after */
        .page-break-after {
            page-break-after: always;
            break-after: page;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
</head>
<body>
    <div class="container">

        <div class="flags">
            <span class="flag">🇬🇷</span> <!-- Greek flag -->
            <span class="flag">🇦🇺</span> <!-- Australian flag -->
        </div>

        <div class="header">

            <div class="profile-picture-container">
                <img src="https://raw.githubusercontent.com/psavidis/resume/refs/heads/master/assets/profile_picture.jpeg" alt="Profile Picture" class="profile-picture">
            </div>

            <h1 id="name">Your Name</h1>

        </div>

        <div>
            <p id="summary">Your professional summary goes here...</p>
            <p id="summary-free">In my free time, I like to travel, play music, explore philosophy and swim</p>
        </div>

        <div class="section" id="experience">
            <h2 id="experienceTitle">Experience</h2>
            <ul id="experience-list"></ul>
        </div>

        <div class="section avoid-break" id="Projects">
            <h2>Projects</h2>
            <ul id="projects-list"></ul>
        </div>

        <div class="section avoid-break" id="education">
            <h2>Education</h2>
            <ul id="education-list"></ul>
        </div>
    </div>

    <div class="button-container">
        <button class="btn" onclick="window.location.href='mailto:peter.savidis1@gmail.com'"><i class="fas fa-envelope"></i></button>
        <button class="btn" onclick="window.location.href='tel:+306975064122'"><i class="fas fa-phone-alt"></i></button>
        <button class="btn" onclick="window.open('https://www.google.com.au/maps/place/Melbourne+VIC/@-37.9648869,143.8048508,9z/data=!3m1!4b1!4m6!3m5!1s0x6ad646b5d2ba4df7:0x4045675218ccd90!8m2!3d-37.8136276!4d144.9630576!16zL20vMGNoZ3pt?entry=ttu&g_ep=EgoyMDI1MDQwMS4wIKXMDSoASAFQAw%3D%3D', '_blank')"><i class="fas fa-map-marker-alt"></i></button>
        <button class="btn" onclick="window.location.href='https://www.linkedin.com/in/petros-savvidis-8994b857/'"><i class="fab fa-linkedin-in"></i></button>
        <button class="btn" onclick="window.location.href='https://www.facebook.com'"><i class="fab fa-facebook-f"></i></button>
        <button class="btn" id="pdf-btn"><i class="fas fa-file-pdf"></i></button>
    </div>

    <script>
        async function loadResumeData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/psavidis/resume/refs/heads/master/assets/data.json');
                if (!response.ok) throw new Error('Failed to fetch data');

                const data = await response.json();

                populateHeader(data);
                populateWorkExperience(data);
                populateProjects(data);
                populateEducation(data);

            } catch (error) {
                console.error('Error loading resume data:', error);
            }
        }

        function populateHeader(data) {
            document.getElementById('name').textContent = data.name || 'Name not provided';

            let fontSize = '15px';

            let summary = document.getElementById('summary');
            summary.textContent = data.summary || 'Summary not provided';
            summary.style.textAlign = 'left';
            summary.style.fontSize = fontSize;

            let summaryFree = document.getElementById('summary-free');
            summaryFree.style.textAlign = 'left';
            summaryFree.style.fontSize = fontSize;
        }

        function populateWorkExperience(data) {
            const experienceList = document.getElementById('experience-list');
            experienceList.innerHTML = '';

            if (!Array.isArray(data.workExperience)) {
                experienceList.innerHTML = '<li>No experience data available</li>';
                return;
            }

            data.workExperience = sortByField(data.workExperience, 'startDate', 'asc');

            data.workExperience.forEach(item => {
                const li = document.createElement('li');
                li.classList.add('work-experience');

                const workTitleAndImg = document.createElement('div');
                workTitleAndImg.classList.add('work-title');

                // Create company logo image
                const companyImg = createCompanyImg(item);

                // Create text span for job details
                const textSpan = document.createElement('span');
                textSpan.textContent = `${item.title || 'Position not provided'} at ${item.company || 'Company not provided'} (${item.startDate || ''} - ${item.endDate || 'Present'})`;

                workTitleAndImg.appendChild(companyImg);
                workTitleAndImg.appendChild(textSpan);

                const div = document.createElement('div');
                div.classList.add('location-badge');

                const span = document.createElement('span');
                div.appendChild(span);
                div.textContent = '📍' + item.location;

                // Append logo and text
                li.appendChild(workTitleAndImg);
                li.appendChild(div);

                experienceList.appendChild(li);
            });

            const totalXP = getTotalExperience(data.workExperience);
            const formattedXP = formatTotalExperienceIntoYears(totalXP);

            document.getElementById('experienceTitle').textContent = 'Experience (' + formattedXP + ')';
        }

        function formatTotalExperienceIntoYears(totalExperience) {
            const years = totalExperience.years;
            const months = totalExperience.months;

            // Format the output
            if (months > 0) {
                return `${years}+ years`; // If there are months, show a +
            } else {
                return `${years} years`; // If no months, show only years with a "+"
            }
        }

        function populateProjects(data) {
            const projectsList = document.getElementById('projects-list');
            projectsList.innerHTML = '';

            if (!Array.isArray(data.project)) {
                projectsList.innerHTML = '<li>No projects data available</li>';
                return;
            }

            data.project = sortByField(data.project, 'startDate', 'desc');

            data.project.forEach(project => {
                const li = document.createElement('li');

                li.style.cursor = 'pointer';
                li.style.padding = '12px';
                li.style.border = '1px solid #ccc';
                li.style.borderRadius = '8px';
                li.style.marginBottom = '8px';
                li.style.backgroundColor = '#f9f9f9';
                li.style.transition = 'background-color 0.2s ease-in-out';

                li.addEventListener('mouseenter', () => {
                    li.style.backgroundColor = '#e3eafc';
                });
                li.addEventListener('mouseleave', () => {
                    li.style.backgroundColor = '#f9f9f9';
                });

                // Project name
                const projectName = document.createElement('span');
                projectName.textContent = project.name || 'Project not provided';
                projectName.style.color = '#1e3c72';
                projectName.style.fontSize = '18px';
                projectName.style.fontWeight = 'bold';

                // Description
                const projectDescription = document.createElement('p');
                projectDescription.textContent = project.description || 'No description provided';
                projectDescription.style.display = 'none';
                projectDescription.style.fontSize = '14px';
                projectDescription.style.color = '#444';
                projectDescription.style.marginTop = '10px';
                projectDescription.style.textAlign = 'left';

                // Tools Used
                const techUsed = document.createElement('p');
                techUsed.textContent = project.techUsed ? `Tools: ${project.techUsed.join(', ')}` : '';
                techUsed.style.display = 'none';
                techUsed.style.fontSize = '13px';
                techUsed.style.fontStyle = 'italic';
                techUsed.style.color = '#666';
                techUsed.style.marginTop = '5px';
                techUsed.style.textAlign = 'left';

                // Points (bullet list)
                const pointsList = document.createElement('ul');
                pointsList.style.display = 'none';
                pointsList.style.paddingLeft = '20px';
                pointsList.style.listStyleType = 'disc';
                pointsList.style.marginTop = '5px';
                pointsList.style.fontSize = '13px';

                if (project.points && Array.isArray(project.points)) {
                    project.points.forEach(point => {
                        const pointItem = document.createElement('li');
                        pointItem.textContent = point.toString();
                        pointItem.style.marginBottom = '3px';
                        pointItem.style.listStyleType = 'circle';
                        pointItem.style.background = 'none';
                        pointItem.style.padding = '2px 0';
                        pointItem.style.backgroundColor = 'transparent';
                        pointItem.style.border = 'none';
                        pointItem.style.boxShadow = 'none';
                        pointsList.appendChild(pointItem);
                    });
                }

                const showProjectButtons = createShowProjectButtons(project);

                const hasProjectButtons = showProjectButtons.length > 0;

                // Toggle description/tech/points on click
                li.addEventListener('click', () => {
                    const isVisible = projectDescription.style.display === 'block';
                    projectDescription.style.display = isVisible ? 'none' : 'block';
                    pointsList.style.display = isVisible ? 'none' : 'block';
                    techUsed.style.display = isVisible ? 'none' : 'block';

                    if (hasProjectButtons) {
                        showProjectButtons.forEach(button => {
                            button.style.display = isVisible ? 'none' : 'inline-block';
                        });
                    }
                });

                li.appendChild(projectName);
                li.appendChild(projectDescription);
                li.appendChild(pointsList);
                li.appendChild(document.createElement('br'));

                let hasTechUsed = techUsed && techUsed.textContent.trim() !== "Tools:";

                if (hasTechUsed) {
                    li.appendChild(techUsed);
                }

                if (hasProjectButtons) {
                    showProjectButtons.forEach(button => {
                        li.appendChild(button);
                    });
                }

                projectsList.appendChild(li);
            });
        }


        function createCompanyImg(item) {
            const img = document.createElement('img');

            img.src = item.companyLogo;
            img.classList.add('project-image');
            img.style.width = '40px';
            img.style.height = '40px';
            img.style.borderRadius = '50%';
            img.style.marginRight = '10px';
            img.style.verticalAlign = 'middle';

            const link = document.createElement('a');
            link.href = item.companyLink || '#'; // Default to "#" if no URL provided

            link.appendChild(img);

            return link;
        }

        function createSchoolImg(item) {
            const img = document.createElement('img');

            img.src = item.schoolLogo;
            img.classList.add('university-image');
            img.style.width = '40px';
            img.style.height = '40px';
            img.style.borderRadius = '50%';
            img.style.marginRight = '10px';
            img.style.verticalAlign = 'middle';

            const link = document.createElement('a');
            link.href = item.schoolLink || '#'; // Default to "#" if no URL provided

            link.appendChild(img);

            return link;
        }

        function createShowProjectButtons(project) {
            const projectLinks = project.links;

            if (!Array.isArray(projectLinks)) {
                return []; // No references to show
            }

            let result = [];

            projectLinks.forEach(link => {
                const showProjectButton = document.createElement('a');

                showProjectButton.textContent = 'Show Project';
                showProjectButton.href = link || '#'; // Default to "#" if no URL provided
                showProjectButton.target = '_blank'; // Open in new tab
                showProjectButton.style.display = 'none';
                showProjectButton.style.marginTop = '10px';
                showProjectButton.style.marginRight = '10px'; // Add margin between buttons
                showProjectButton.style.padding = '8px 12px';
                showProjectButton.style.background = '#007BFF';
                showProjectButton.style.color = 'white';
                showProjectButton.style.textDecoration = 'none';
                showProjectButton.style.borderRadius = '5px';
                showProjectButton.style.fontSize = '11px';
                showProjectButton.style.fontWeight = 'bold';
                showProjectButton.style.textAlign = 'center';
                showProjectButton.style.width = 'fit-content';
                showProjectButton.style.transition = 'background 0.3s';

                // Button hover effect
                showProjectButton.addEventListener('mouseover', () => {
                    showProjectButton.style.background = '#0056b3';
                });
                showProjectButton.addEventListener('mouseout', () => {
                    showProjectButton.style.background = '#007BFF';
                });

                result.push(showProjectButton);
            });

            return result;
        }

        function populateEducation(data) {
            const educationList = document.getElementById('education-list');

            if (!Array.isArray(data.education)) {
                educationList.innerHTML = '<li>No education data available</li>';
                return;
            }

            data.education.forEach(item => {
                const li = document.createElement('li');

                const textSpan = document.createElement('span');
                textSpan.textContent = `${item.school || 'Institution not provided'}, ${item.degree || 'Field of study not provided'} (${item.startYear || ''} - ${item.endYear || 'Present'})`;

                const schoolImg = createSchoolImg(item);

                li.appendChild(schoolImg);
                li.appendChild(textSpan);

                educationList.appendChild(li);
            });
        }

        function downloadPage() {
            const resume = document.querySelector('.container');

            if (!resume) {
                console.error("Resume container not found!");
                return;
            }

            // Add class to disable transforms, animations, etc.
            resume.classList.add('pdf-mode');

            // Give the browser time to apply styles
            setTimeout(() => {
                html2pdf()
                    .set({
                        margin: 0,
                        filename: 'resume.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: {
                            scale: 2,
                            useCORS: true,
                            logging: true,
                            backgroundColor: '#ffffff',
                            scrollY: 0
                        },
                        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
                    })
                    .from(resume)
                    .save()
                    .then(() => {
                        resume.classList.remove('pdf-mode');
                    })
                    .catch(err => {
                        console.error("PDF generation failed:", err);
                        resume.classList.remove('pdf-mode');
                    });
            }, 300); // give time for the style to apply
        }

        // Function to parse and compare dates
        function sortByField(data, field, order = 'desc') {
            return data.sort((a, b) => {
                // Extract the date components (e.g., "MM-YYYY")
                const [monthA, yearA] = a[field].split('-');
                const [monthB, yearB] = b[field].split('-');

                // Create Date objects from the extracted month and year
                const dateA = new Date(yearA, monthA - 1);  // monthA - 1 because months are 0-indexed
                const dateB = new Date(yearB, monthB - 1);  // monthB - 1 for the same reason

                // Return based on the order: ascending or descending
                if (order === 'asc') {
                    return dateA - dateB; // ascending order
                } else {
                    return dateB - dateA; // descending order
                }
            });
        }

        function calculateExperience(startDate, endDate) {
            const start = new Date(startDate);
            const end = (endDate === 'Present') ? new Date() : new Date(endDate);  // Handle 'Present' as current date

            return (end.getFullYear() - start.getFullYear()) * 12 + (end.getMonth() - start.getMonth());
        }

        // Function to calculate the total experience
        function getTotalExperience(workExperience) {
            let totalExperienceMonths = 0;

            workExperience.forEach(job => {

                if (job.company === 'Hellenic Army') {
                    return;
                }

                totalExperienceMonths += calculateExperience(job.startDate, job.endDate);
            });

            // Convert the total experience to years and months
            const years = Math.floor(totalExperienceMonths / 12);
            const months = totalExperienceMonths % 12;

            return { years, months };
        }

        loadResumeData();

        document.getElementById('pdf-btn').addEventListener('click', downloadPage);
    </script>
</body>
</html>
